#!/usr/bin/env node

'use strict'

const assert = require('assert')
const { argv } = require('yargs')
  .boolean(['quiet'])
  .alias('quiet', 'q')

const publish = require('../src/publish')

try {
  const dotenv = require('dotenv')
  dotenv.config()
} catch (err) {
  // dotenv is optional dependency, don't throw if it's not installed
}

const { NPM_TOKEN, NPMRC_DIR } = process.env

try {
  assert(NPM_TOKEN, 'publish: NPM_TOKEN is required')
  const published = publish({ NPM_TOKEN, NPMRC_DIR })
  if (! argv.quiet && ! published) console.log('publish: Not on master branch, skipping.')
  if (! argv.quiet && published) console.log('publish: new version published to npm.')
} catch (err) {
  console.log(err.message)
  process.exit(1)
}
