#!/usr/bin/env node

'use strict'

const fs = require('fs')
const spawn = require('cross-spawn')

const { CIRCLE_BRANCH, NPM_TOKEN, HOME } = process.env

if (! NPM_TOKEN) {
  console.log('publish: NPM_TOKEN is required')
  process.exit(1)
}

if (CIRCLE_BRANCH === 'master') {
  fs.writeFileSync(`${HOME}/.npmrc`, `//registry.npmjs.org/:_authToken=${NPM_TOKEN}`, 'utf8')

  spawn.sync('npm', ['publish', '--access=public'], { stdio: 'inherit' })
} else {
  console.log('publish: Not on master branch, skipping')
  process.exit(0)
}

